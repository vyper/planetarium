#!/usr/bin/env ruby

$:.unshift File.join(File.dirname(__FILE__), *%w[.. lib])

require 'planetarium'

Main {
  version Planetarium::VERSION

  description <<-TXT
    Fork of PlanetPlanet in Ruby
    
    Run 'planetarium [command] help' for more informations
  TXT

  mode(:update) {
    description 'Update planetarium'
  
    run { Planetarium::Command.update }
  }

  mode(:version) {
    description 'Show planetarium version'
    
    run { puts "Planetarium #{version}" }
  }
  
  mode(:list) {
    description 'List feeds in planetarium'
    
    run { Planetarium::Command.list }
  }
  
  mode(:add) {
    description 'Add a feed to planetarium'
    
    example <<-TXT
      $ planetarium add url_feed_to_remove
      $ planetarium add http://www.mcorp.com.br/feed/atom
    TXT
    
    mixin :argument_url
    
    run { 
      Planetarium::Command.add(url) 
    }
  }
  
  mode(:del) {
    description 'Remove a feed from planetarium'
    
    example <<-TXT
      $ planetarium del url_feed_to_remove
      $ planetarium del http://www.mcorp.com.br/feed/atom
    TXT
    
    mixin :argument_url
    
    run { 
      Planetarium::Command.del(url) 
    }
  }
  
  mixin(:argument_url) {
    argument(:url) {
      attr
    }
  }
  
  run { help! }
}
